# Importamos las librerías necesarias
import paths
import os
from pickle import FALSE, NONE
import time
from datetime import datetime
from datetime import date, datetime, timedelta,timezone
import urllib.request
import pandas as pd
import numpy as np
import seaborn as sb
from os import remove
import threading


espacio = '-------------'

#Definimoa la función "procesonew" para las nuevas estaciones y que será llamada como un modulo en el script python.py
def procesonew(nombre, clave):
    
    dirtxt=paths.tempo+clave+'.txt'
    dircsv=paths.file+clave+'.csv'
    url = 'http://189.254.33.151/pron/2023/'+clave+'/download.txt'

    print(dirtxt)
    print(dircsv)
    print(url)

    now = datetime.now()

    yesterday=now-timedelta(days=1)
    print(yesterday)

    yesterdaybefore=now-timedelta(days=2)
    print(yesterdaybefore)

    hoy0=datetime.strftime(now,'%d').lstrip('0')
    meshoy0=datetime.strftime(now,'%m')
    añohoy0=datetime.strftime(now,'%y')
    fecha_hoyi= hoy0 +"/"+ meshoy0 +"/"+ añohoy0
    fecha_hoy0=str(fecha_hoyi)
    print(fecha_hoy0)
    print("la fecha de hoy con un digito es (hoy0) " + fecha_hoy0+" fecha_hoy0")

    ayer0=datetime.strftime(yesterday,'%d').lstrip('0')
    mesayer0=datetime.strftime(yesterday,'%m')
    añoayer0=datetime.strftime(yesterday,'%y')
    fecha_ayeri= ayer0 +"/"+ mesayer0 +"/"+ añoayer0
    fecha_ayer0=str(fecha_ayeri)
    print(fecha_ayer0)
    print("la fecha de ayer con un digito es (ayer0) " + fecha_ayer0+" fecha_ayer0")

    anteayer0=datetime.strftime(yesterdaybefore,'%d').lstrip('0')
    mesanteayer0=datetime.strftime(yesterdaybefore,'%m')
    añoanteayer0=datetime.strftime(yesterdaybefore,'%y')
    fecha_anteayeri= anteayer0 +"/"+ mesanteayer0 +"/"+ añoanteayer0
    fecha_anteayer0=str(fecha_anteayeri)
    print(fecha_anteayer0)
    print("la fecha de ante ayer con un digito es (ayer0) " + fecha_anteayer0+" fecha_anteayerayer0")

    hoy1=datetime.strftime(now,'%d')
    meshoy1=datetime.strftime(now,'%m')
    añohoy1=datetime.strftime(now,'%y')
    fecha_hoy1= hoy1 +"/"+ meshoy1 +"/"+ añohoy1
    fecha_hoyic= "," + hoy1 +"/"+ meshoy1 +"/"+ añohoy1
    fecha_hoyc=str(fecha_hoyic)
    print(fecha_hoyc)
    print("la fecha de hoy con dos digitos es " + fecha_hoyc+ " fecha_hoyc")

    ayer1=datetime.strftime(yesterday,'%d')
    mesayer1=datetime.strftime(yesterday,'%m')
    añoayer1=datetime.strftime(yesterday,'%y')
    fecha_ayer1= ayer1 +"/"+ mesayer1 +"/"+ añoayer1
    fecha_ayeric=  "," + ayer1 +"/"+ mesayer1 +"/"+ añoayer1
    fecha_ayerc=str(fecha_ayeric)
    print(fecha_ayerc)
    print("la fecha de ayer con dos digitos es " + fecha_ayerc+" fecha_ayerc")

    anteayer1=datetime.strftime(yesterdaybefore,'%d')
    mesanteayer1=datetime.strftime(yesterdaybefore,'%m')
    añoanteayer1=datetime.strftime(yesterdaybefore,'%y')
    fecha_anteayer1= anteayer1 +"/"+ mesanteayer1 +"/"+ añoanteayer1
    fecha_anteayeric=  "," + anteayer1 +"/"+ mesanteayer1 +"/"+ añoanteayer1
    fecha_anteayerc=str(fecha_anteayeric)
    print(fecha_anteayerc)
    print("la fecha de anteayer con dos digitos es " + fecha_anteayerc+" fecha_anteayerayerc")

    espacio = '-------------'

    print('Buscando datos de',clave)

    try:
        print(espacio)
        file1 = dirtxt
        r = urllib.request.urlopen(url)
        f = open(file1,'wb')
        f.write(r.read())
        f.close()
        #print(file1)
        print('Datos de la estación',nombre,'obtenidos')

        print('Datos de la estación estacion',clave,'listos')
    except:
        print("No se logro obtener datos de la estación",clave)
        print(espacio)

#Se eliminaran las primeras lineas del archivo txt

    try:
        with open(dirtxt, "r") as fr:
            #Leyedo linea por linea
            lines = fr.readlines()

            # Posicion del puntero
            ptr = 1

            # Abiendo en modo de escritura
            with open(dirtxt, 'w') as fw:
                for line in lines:

                    # Se elimina la primera linea 
                    if ptr != 1:
                        fw.write(line)
                    ptr += 1
        print("Deleted")

    except:
        print("Oops! No se pudo eliminar fila")

    try:
        with open(dirtxt, 'r') as fr:
            
            lines = fr.readlines()

            ptr = 1

            # Abriendo en modo de escritura
            with open(dirtxt, 'w') as fw:
                for line in lines:

                    # Eliminamos la segunda linea
                    if ptr != 2:
                        fw.write(line)
                    ptr += 1
        print("Deleted")

    except:
        print("Oops! No se pudo eliminar fila")

    try:
        estacion=open(dirtxt)
        texto0=estacion.read()
        texto1=texto0.replace(fecha_anteayer0,fecha_anteayerc)
        texto2=texto1.replace(fecha_ayer0,fecha_ayerc)
        texto3=texto2.replace(fecha_hoy0,fecha_hoyc)
        texto4=texto3.replace(fecha_anteayer1,fecha_anteayerc)
        texto5=texto4.replace(fecha_ayer1,fecha_ayerc)
        texto6=texto5.replace(fecha_hoy1,fecha_hoyc)
        texto7=texto6.replace(" ",",")
        texto8=texto7.replace("---","9999")
        texto9=texto8.replace(",,",",")
        texto10=texto9.replace(",,,",",")
        texto11=texto10.replace(",,,,",",")
        texto12=texto11.replace(",,", ",")
        #print(texto12)
        estacion1=open(dirtxt,"w")
        estacion1.write(texto12)
        estacion1.close()

        estacion=open(dirtxt)
        texto=estacion.read()
        texto0=texto.replace("12:00a","00:00")
        texto1=texto0.replace("12:05a","00:05")
        texto2=texto1.replace("12:10a","00:10")
        texto3=texto2.replace("12:15a","00:15")
        texto4=texto3.replace("12:20a","00:20")
        texto5=texto4.replace("12:25a","00:25")
        texto6=texto5.replace("12:30a","00:30")
        texto7=texto6.replace("12:35a","00:35")
        texto8=texto7.replace("12:40a","00:40")
        texto9=texto8.replace("12:45a","00:45")
        texto10=texto9.replace("12:50a","00:50")
        texto11=texto10.replace("12:55a","00:55")
        texto12=texto11.replace("1:00a","01:00")
        texto13=texto12.replace("1:05a","01:05")
        texto14=texto13.replace("1:10a","01:10")
        texto15=texto14.replace("1:15a","01:15")
        texto16=texto15.replace("1:20a","01:20")
        texto17=texto16.replace("1:25a","01:25")
        texto18=texto17.replace("1:30a","01:30")
        texto19=texto18.replace("1:35a","01:35")
        texto20=texto19.replace("1:40a","01:40")
        texto21=texto20.replace("1:45a","01:45")
        texto22=texto21.replace("1:50a","01:50")
        texto23=texto22.replace("1:55a","01:55")
        texto24=texto23.replace("2:00a","02:00")
        texto25=texto24.replace("2:05a","02:05")
        texto26=texto25.replace("2:10a","02:10")
        texto27=texto26.replace("2:15a","02:15")
        texto28=texto27.replace("2:20a","02:20")
        texto29=texto28.replace("2:25a","02:25")
        texto30=texto29.replace("2:30a","02:30")
        texto31=texto30.replace("2:35a","02:35")
        texto32=texto31.replace("2:40a","02:40")
        texto33=texto32.replace("2:45a","02:45")
        texto34=texto33.replace("2:50a","02:50")
        texto35=texto34.replace("2:55a","02:55")
        texto36=texto35.replace("3:00a","03:00")
        texto37=texto36.replace("3:05a","03:05")
        texto38=texto37.replace("3:10a","03:10")
        texto39=texto38.replace("3:15a","03:15")
        texto40=texto39.replace("3:20a","03:20")
        texto41=texto40.replace("3:25a","03:25")
        texto42=texto41.replace("3:30a","03:30")
        texto43=texto42.replace("3:35a","03:35")
        texto44=texto43.replace("3:40a","03:40")
        texto45=texto44.replace("3:45a","03:45")
        texto46=texto45.replace("3:50a","03:50")
        texto47=texto46.replace("3:55a","03:55")
        texto48=texto47.replace("4:00a","04:00")
        texto49=texto48.replace("4:05a","04:05")
        texto50=texto49.replace("4:10a","04:10")
        texto51=texto50.replace("4:15a","04:15")
        texto52=texto51.replace("4:20a","04:20")
        texto53=texto52.replace("4:25a","04:25")
        texto54=texto53.replace("4:30a","04:30")
        texto55=texto54.replace("4:35a","04:35")
        texto56=texto55.replace("4:40a","04:40")
        texto57=texto56.replace("4:45a","04:45")
        texto58=texto57.replace("4:50a","04:50")
        texto59=texto58.replace("4:55a","04:55")
        texto60=texto59.replace("5:00a","05:00")
        texto61=texto60.replace("5:05a","05:05")
        texto62=texto61.replace("5:10a","05:10")
        texto63=texto62.replace("5:15a","05:15")
        texto64=texto63.replace("5:20a","05:20")
        texto65=texto64.replace("5:25a","05:25")
        texto66=texto65.replace("5:30a","05:30")
        texto67=texto66.replace("5:35a","05:35")
        texto68=texto67.replace("5:40a","05:40")
        texto69=texto68.replace("5:45a","05:45")
        texto70=texto69.replace("5:50a","05:50")
        texto71=texto70.replace("5:55a","05:55")
        texto72=texto71.replace("6:00a","06:00")
        texto73=texto72.replace("6:05a","06:05")
        texto74=texto73.replace("6:10a","06:10")
        texto75=texto74.replace("6:15a","06:15")
        texto76=texto75.replace("6:20a","06:20")
        texto77=texto76.replace("6:25a","06:25")
        texto78=texto77.replace("6:30a","06:30")
        texto79=texto78.replace("6:35a","06:35")
        texto80=texto79.replace("6:40a","06:40")
        texto81=texto80.replace("6:45a","06:45")
        texto82=texto81.replace("6:50a","06:50")
        texto83=texto82.replace("6:55a","06:55")
        texto84=texto83.replace("7:00a","07:00")
        texto85=texto84.replace("7:05a","07:05")
        texto86=texto85.replace("7:10a","07:10")
        texto87=texto86.replace("7:15a","07:15")
        texto88=texto87.replace("7:20a","07:20")
        texto89=texto88.replace("7:25a","07:25")
        texto90=texto89.replace("7:30a","07:30")
        texto91=texto90.replace("7:35a","07:35")
        texto92=texto91.replace("7:40a","07:40")
        texto93=texto92.replace("7:45a","07:45")
        texto94=texto93.replace("7:50a","07:50")
        texto95=texto94.replace("7:55a","07:55")
        texto96=texto95.replace("8:00a","08:00")
        texto97=texto96.replace("8:05a","08:05")
        texto98=texto97.replace("8:10a","08:10")
        texto99=texto98.replace("8:15a","08:15")
        texto100=texto99.replace("8:20a","08:20")
        texto101=texto100.replace("8:25a","08:25")
        texto102=texto101.replace("8:30a","08:30")
        texto103=texto102.replace("8:35a","08:35")
        texto104=texto103.replace("8:40a","08:40")
        texto105=texto104.replace("8:45a","08:45")
        texto106=texto105.replace("8:50a","08:50")
        texto107=texto106.replace("8:55a","08:55")
        texto108=texto107.replace("9:00a","09:00")
        texto109=texto108.replace("9:05a","09:05")
        texto110=texto109.replace("9:10a","09:10")
        texto111=texto110.replace("9:15a","09:15")
        texto112=texto111.replace("9:20a","09:20")
        texto113=texto112.replace("9:25a","09:25")
        texto114=texto113.replace("9:30a","09:30")
        texto115=texto114.replace("9:35a","09:35")
        texto116=texto115.replace("9:40a","09:40")
        texto117=texto116.replace("9:45a","09:45")
        texto118=texto117.replace("9:50a","09:50")
        texto119=texto118.replace("9:55a","09:55")
        texto120=texto119.replace("10:00a","10:00")
        texto121=texto120.replace("10:05a","10:05")
        texto122=texto121.replace("10:10a","10:10")
        texto123=texto122.replace("10:15a","10:15")
        texto124=texto123.replace("10:20a","10:20")
        texto125=texto124.replace("10:25a","10:25")
        texto126=texto125.replace("10:30a","10:30")
        texto127=texto126.replace("10:35a","10:35")
        texto128=texto127.replace("10:40a","10:40")
        texto129=texto128.replace("10:45a","10:45")
        texto130=texto129.replace("10:50a","10:50")
        texto131=texto130.replace("10:55a","10:55")
        texto132=texto131.replace("11:00a","11:00")
        texto133=texto132.replace("11:05a","11:05")
        texto134=texto133.replace("11:10a","11:10")
        texto135=texto134.replace("11:15a","11:15")
        texto136=texto135.replace("11:20a","11:20")
        texto137=texto136.replace("11:25a","11:25")
        texto138=texto137.replace("11:30a","11:30")
        texto139=texto138.replace("11:35a","11:35")
        texto140=texto139.replace("11:40a","11:40")
        texto141=texto140.replace("11:45a","11:45")
        texto142=texto141.replace("11:50a","11:50")
        texto143=texto142.replace("11:55a","11:55")
        texto144=texto143.replace("12:00p","12:00")
        texto145=texto144.replace("12:05p","12:05")
        texto146=texto145.replace("12:10p","12:10")
        texto147=texto146.replace("12:15p","12:15")
        texto148=texto147.replace("12:20p","12:20")
        texto149=texto148.replace("12:25p","12:25")
        texto150=texto149.replace("12:30p","12:30")
        texto151=texto150.replace("12:35p","12:35")
        texto152=texto151.replace("12:40p","12:40")
        texto153=texto152.replace("12:45p","12:45")
        texto154=texto153.replace("12:50p","12:50")
        texto155=texto154.replace("12:55p","12:55")
        texto156=texto155.replace("1:00p","13:00")
        texto157=texto156.replace("1:05p","13:05")
        texto158=texto157.replace("1:10p","13:10")
        texto159=texto158.replace("1:15p","13:15")
        texto160=texto159.replace("1:20p","13:20")
        texto161=texto160.replace("1:25p","13:25")
        texto162=texto161.replace("1:30p","13:30")
        texto163=texto162.replace("1:35p","13:35")
        texto164=texto163.replace("1:40p","13:40")
        texto165=texto164.replace("1:45p","13:45")
        texto166=texto165.replace("1:50p","13:50")
        texto167=texto166.replace("1:55p","13:55")
        texto168=texto167.replace("2:00p","14:00")
        texto169=texto168.replace("2:05p","14:05")
        texto170=texto169.replace("2:10p","14:10")
        texto171=texto170.replace("2:15p","14:15")
        texto172=texto171.replace("2:20p","14:20")
        texto173=texto172.replace("2:25p","14:25")
        texto174=texto173.replace("2:30p","14:30")
        texto175=texto174.replace("2:35p","14:35")
        texto176=texto175.replace("2:40p","14:40")
        texto177=texto176.replace("2:45p","14:45")
        texto178=texto177.replace("2:50p","14:50")
        texto179=texto178.replace("2:55p","14:55")
        texto180=texto179.replace("3:00p","15:00")
        texto181=texto180.replace("3:05p","15:05")
        texto182=texto181.replace("3:10p","15:10")
        texto183=texto182.replace("3:15p","15:15")
        texto184=texto183.replace("3:20p","15:20")
        texto185=texto184.replace("3:25p","15:25")
        texto186=texto185.replace("3:30p","15:30")
        texto187=texto186.replace("3:35p","15:35")
        texto188=texto187.replace("3:40p","15:40")
        texto189=texto188.replace("3:45p","15:45")
        texto190=texto189.replace("3:50p","15:50")
        texto191=texto190.replace("3:55p","15:55")
        texto192=texto191.replace("4:00p","16:00")
        texto193=texto192.replace("4:05p","16:05")
        texto194=texto193.replace("4:10p","16:10")
        texto195=texto194.replace("4:15p","16:15")
        texto196=texto195.replace("4:20p","16:20")
        texto197=texto196.replace("4:25p","16:25")
        texto198=texto197.replace("4:30p","16:30")
        texto199=texto198.replace("4:35p","16:35")
        texto200=texto199.replace("4:40p","16:40")
        texto201=texto200.replace("4:45p","16:45")
        texto202=texto201.replace("4:50p","16:50")
        texto203=texto202.replace("4:55p","16:55")
        texto204=texto203.replace("5:00p","17:00")
        texto205=texto204.replace("5:05p","17:05")
        texto206=texto205.replace("5:10p","17:10")
        texto207=texto206.replace("5:15p","17:15")
        texto208=texto207.replace("5:20p","17:20")
        texto209=texto208.replace("5:25p","17:25")
        texto210=texto209.replace("5:30p","17:30")
        texto211=texto210.replace("5:35p","17:35")
        texto212=texto211.replace("5:40p","17:40")
        texto213=texto212.replace("5:45p","17:45")
        texto214=texto213.replace("5:50p","17:50")
        texto215=texto214.replace("5:55p","17:55")
        texto216=texto215.replace("6:00p","18:00")
        texto217=texto216.replace("6:05p","18:05")
        texto218=texto217.replace("6:10p","18:10")
        texto219=texto218.replace("6:15p","18:15")
        texto220=texto219.replace("6:20p","18:20")
        texto221=texto220.replace("6:25p","18:25")
        texto222=texto221.replace("6:30p","18:30")
        texto223=texto222.replace("6:35p","18:35")
        texto224=texto223.replace("6:40p","18:40")
        texto225=texto224.replace("6:45p","18:45")
        texto226=texto225.replace("6:50p","18:50")
        texto227=texto226.replace("6:55p","18:55")
        texto228=texto227.replace("7:00p","19:00")
        texto229=texto228.replace("7:05p","19:05")
        texto230=texto229.replace("7:10p","19:10")
        texto231=texto230.replace("7:15p","19:15")
        texto232=texto231.replace("7:20p","19:20")
        texto233=texto232.replace("7:25p","19:25")
        texto234=texto233.replace("7:30p","19:30")
        texto235=texto234.replace("7:35p","19:35")
        texto236=texto235.replace("7:40p","19:40")
        texto237=texto236.replace("7:45p","19:45")
        texto238=texto237.replace("7:50p","19:50")
        texto239=texto238.replace("7:55p","19:55")
        texto240=texto239.replace("8:00p","20:00")
        texto241=texto240.replace("8:05p","20:05")
        texto242=texto241.replace("8:10p","20:10")
        texto243=texto242.replace("8:15p","20:15")
        texto244=texto243.replace("8:20p","20:20")
        texto245=texto244.replace("8:25p","20:25")
        texto246=texto245.replace("8:30p","20:30")
        texto247=texto246.replace("8:35p","20:35")
        texto248=texto247.replace("8:40p","20:40")
        texto249=texto248.replace("8:45p","20:45")
        texto250=texto249.replace("8:50p","20:50")
        texto251=texto250.replace("8:55p","20:55")
        texto252=texto251.replace("9:00p","21:00")
        texto253=texto252.replace("9:05p","21:05")
        texto254=texto253.replace("9:10p","21:10")
        texto255=texto254.replace("9:15p","21:15")
        texto256=texto255.replace("9:20p","21:20")
        texto257=texto256.replace("9:25p","21:25")
        texto258=texto257.replace("9:30p","21:30")
        texto259=texto258.replace("9:35p","21:35")
        texto260=texto259.replace("9:40p","21:40")
        texto261=texto260.replace("9:45p","21:45")
        texto262=texto261.replace("9:50p","21:50")
        texto263=texto262.replace("9:55p","21:55")
        texto264=texto263.replace("10:00p","22:00")
        texto265=texto264.replace("10:05p","22:05")
        texto266=texto265.replace("10:10p","22:10")
        texto267=texto266.replace("10:15p","22:15")
        texto268=texto267.replace("10:20p","22:20")
        texto269=texto268.replace("10:25p","22:25")
        texto270=texto269.replace("10:30p","22:30")
        texto271=texto270.replace("10:35p","22:35")
        texto272=texto271.replace("10:40p","22:40")
        texto273=texto272.replace("10:45p","22:45")
        texto274=texto273.replace("10:50p","22:50")
        texto275=texto274.replace("10:55p","22:55")
        texto276=texto275.replace("11:00p","23:00")
        texto277=texto276.replace("11:05p","23:05")
        texto278=texto277.replace("11:10p","23:10")
        texto279=texto278.replace("11:15p","23:15")
        texto280=texto279.replace("11:20p","23:20")
        texto281=texto280.replace("11:25p","23:25")
        texto282=texto281.replace("11:30p","23:30")
        texto283=texto282.replace("11:35p","23:35")
        texto284=texto283.replace("11:40p","23:40")
        texto285=texto284.replace("11:45p","23:45")
        texto286=texto285.replace("11:50p","23:50")
        texto287=texto286.replace("11:55p","23:55")
        texto288=texto287.replace("101:00","11:00")
        texto289=texto288.replace("101:05","11:05")
        texto290=texto289.replace("101:10","11:10")
        texto291=texto290.replace("101:15","11:15")
        texto292=texto291.replace("101:20","11:20")
        texto293=texto292.replace("101:25","11:25")
        texto294=texto293.replace("101:30","11:30")
        texto295=texto294.replace("101:35","11:35")
        texto296=texto295.replace("101:40","11:40")
        texto297=texto296.replace("101:45","11:45")
        texto298=texto297.replace("101:50","11:50")
        texto299=texto298.replace("101:55","11:55")
        texto300=texto299.replace("113:00","23:00")
        texto301=texto300.replace("113:05","23:05")
        texto302=texto301.replace("113:10","23:10")
        texto303=texto302.replace("113:15","23:15")
        texto304=texto303.replace("113:20","23:20")
        texto305=texto304.replace("113:25","23:25")
        texto306=texto305.replace("113:30","23:30")
        texto307=texto306.replace("113:35","23:35")
        texto308=texto307.replace("113:40","23:40")
        texto309=texto308.replace("113:45","23:45")
        texto310=texto309.replace("113:50","23:50")
        texto311=texto310.replace("113:55","23:55")
        estacion1=open(dirtxt,"w")
        estacion1.write(texto311)
        estacion1.close()
        estacion.close()

        #Fecha de corrección 21/02/2023
        estacion=open(dirtxt)
        texto0=estacion.read()
        texto1=texto0.replace(",,",",")
        texto2=texto1.replace(",Date",",Fecha")
        estacion1=open(dircsv,"w")
        estacion1.write(texto2)
        #print(texto2)
        estacion1.close()
        estacion.close()

        estacion=pd.read_csv(dircsv, usecols=(1,2,3,6,7,8,9,11,12,17,18,20), index_col=0, header=0)
        #print(estacion)
        estacion.to_csv(dircsv) 

        estacion=open(dircsv)
        nombrescol=estacion.read()
        texto1=nombrescol.replace("Out","temperatura")
        texto2=texto1.replace("Hum","humedadRelativa")
        texto3=texto2.replace("Pt.","puntoRocio")
        texto4=texto3.replace("Speed.1","velocidadRacha")
        texto5=texto4.replace("Dir.1","direccionRacha")
        texto6=texto5.replace("Speed","velocidadViento")
        texto7=texto6.replace("Dir","direccionViento")
        texto8=texto7.replace("Bar","presionBar")
        texto9=texto8.replace("Rain","lluvia")
        texto10=texto9.replace("Rad.","Rad")
        estacion1=open(dircsv,"w")
        estacion1.write(texto10)
        estacion1.close()
        estacion.close()

        estacion=open(dircsv)
        texto=estacion.read()
        texto1=texto.replace("NNE","22.5")
        texto2=texto1.replace("ENE","67.5")
        texto3=texto2.replace("ESE","112.5")
        texto4=texto3.replace("SSE","157.5")
        texto5=texto4.replace("SSW","202.5")
        texto6=texto5.replace("WSW","247.5")
        texto7=texto6.replace("WNW","292.5")
        texto8=texto7.replace("NNW","337.5")
        texto9=texto8.replace("NE","45")
        texto10=texto9.replace("SE","135")
        texto11=texto10.replace("SW","225")
        texto12=texto11.replace("NW","315")
        estacion1=open(dircsv,"w")
        estacion1.write(texto12)
        estacion1.close()
        estacion.close()

        estacion=open(dircsv)
        texto=estacion.read()
        texto1=texto.replace("N","360")
        texto2=texto1.replace("E","90")
        texto3=texto2.replace("S","180")
        texto4=texto3.replace("W","270")
        estacion1=open(dircsv,"w")
        estacion1.write(texto4)
        estacion1.close()
        estacion.close()
        
        estacion=pd.read_csv(dircsv, index_col=0, header=0)
        #print(estacion)
        estacion['fechaHora']=estacion['Fecha'].map(str)  + ' ' + estacion['Time'].map(str)
        estacion
        #print(estacion)
        estacion.to_csv(dircsv)


        DF=pd.read_csv(dircsv, index_col=0)
        DF['idEstacion']=np.where(DF['Time'] !='[]',clave, ' ', )
        #print(DF)
        DF.to_csv(dircsv)

        estacion=pd.read_csv(dircsv, index_col=0, header=0)
        #print(estacion)
        estacion['radSol']=estacion['Rad'].map(str)
        estacion
        #print(estacion)
        estacion.to_csv(dircsv)

        estacion=pd.read_csv(dircsv, usecols=(3,4,5,6,7,8,9,10,11,13,14,15), index_col=0, header=0)
        print(estacion)
        estacion.to_csv(dircsv)

        print('Datos de la estación estacion',clave,'listos')
        final=datetime.now()
        print("El proceso se completo a las",final,"la proxima ejecución será en 05 minutos")
    except:
        final=datetime.now()
        print("No se logro obtener datos de la estación",clave)
        print("Se presento un error, la próxima ejecición será dentro de 05 minutos a partir de la hora:",final)
        try:
            remove(dircsv)
        except:
            print("No existe el archivo "+ dircsv)


#Definimoa la función "procesoold" para las estaciones anteriores que será llamada como un modulo en el script python.py
def procesoold(nombre, clave):
    print("Ultima actualizacion del programa el día 24/02/23 a las 12:57pm")

    dirtxt=paths.tempo+clave+'.txt'
    dircsv=paths.file+clave+'.csv'
    url = 'http://189.254.33.151/stn/'+nombre+'/downld02.txt'

    print(dirtxt)
    print(dircsv)
    print(url)
    now = datetime.now()

    yesterday=now-timedelta(days=1)
    print(yesterday)

    yesterdaybefore=now-timedelta(days=2)
    print(yesterdaybefore)

    hoy0=datetime.strftime(now,'%d').lstrip('0')
    meshoy0=datetime.strftime(now,'%m')
    añohoy0=datetime.strftime(now,'%y')
    fecha_hoyi= hoy0 +"/"+ meshoy0 +"/"+ añohoy0
    fecha_hoy0=str(fecha_hoyi)
    print(fecha_hoy0)
    print("la fecha de hoy con un digito es (hoy0) " + fecha_hoy0+" fecha_hoy0")

    ayer0=datetime.strftime(yesterday,'%d').lstrip('0')
    mesayer0=datetime.strftime(yesterday,'%m')
    añoayer0=datetime.strftime(yesterday,'%y')
    fecha_ayeri= ayer0 +"/"+ mesayer0 +"/"+ añoayer0
    fecha_ayer0=str(fecha_ayeri)
    print(fecha_ayer0)
    print("la fecha de ayer con un digito es (ayer0) " + fecha_ayer0+" fecha_ayer0")

    anteayer0=datetime.strftime(yesterdaybefore,'%d').lstrip('0')
    mesanteayer0=datetime.strftime(yesterdaybefore,'%m')
    añoanteayer0=datetime.strftime(yesterdaybefore,'%y')
    fecha_anteayeri= anteayer0 +"/"+ mesanteayer0 +"/"+ añoanteayer0
    fecha_anteayer0=str(fecha_anteayeri)
    print(fecha_anteayer0)
    print("la fecha de ante ayer con un digito es (ayer0) " + fecha_anteayer0+" fecha_anteayerayer0")

    hoy1=datetime.strftime(now,'%d')
    meshoy1=datetime.strftime(now,'%m')
    añohoy1=datetime.strftime(now,'%y')
    fecha_hoy1= hoy1 +"/"+ meshoy1 +"/"+ añohoy1
    fecha_hoyic= "," + hoy1 +"/"+ meshoy1 +"/"+ añohoy1
    fecha_hoyc=str(fecha_hoyic)
    print(fecha_hoyc)
    print("la fecha de hoy con dos digitos es " + fecha_hoyc+ " fecha_hoyc")

    ayer1=datetime.strftime(yesterday,'%d')
    mesayer1=datetime.strftime(yesterday,'%m')
    añoayer1=datetime.strftime(yesterday,'%y')
    fecha_ayer1= ayer1 +"/"+ mesayer1 +"/"+ añoayer1
    fecha_ayeric=  "," + ayer1 +"/"+ mesayer1 +"/"+ añoayer1
    fecha_ayerc=str(fecha_ayeric)
    print(fecha_ayerc)
    print("la fecha de ayer con dos digitos es " + fecha_ayerc+" fecha_ayerc")

    anteayer1=datetime.strftime(yesterdaybefore,'%d')
    mesanteayer1=datetime.strftime(yesterdaybefore,'%m')
    añoanteayer1=datetime.strftime(yesterdaybefore,'%y')
    fecha_anteayer1= anteayer1 +"/"+ mesanteayer1 +"/"+ añoanteayer1
    fecha_anteayeric=  "," + anteayer1 +"/"+ mesanteayer1 +"/"+ añoanteayer1
    fecha_anteayerc=str(fecha_anteayeric)
    print(fecha_anteayerc)
    print("la fecha de anteayer con dos digitos es " + fecha_anteayerc+" fecha_anteayerayerc")

    espacio = '-------------'

    print('Buscando datos de',clave)

    try:
        print(espacio)
        file1 = dirtxt
        r = urllib.request.urlopen(url)
        f = open(file1,'wb')
        f.write(r.read())
        f.close()
        #print(file1)
        print('Datos de la estación',nombre,'obtenidos')

        try:
            with open(dirtxt, 'r') as fr:
                # Leyendo linea por linea 
                lines = fr.readlines()

                # Posicion del puntero
                ptr = 1

                # Abiendo en modo de escritura
                with open(dirtxt, 'w') as fw:
                    for line in lines:

                        # Se elimina la primera linea 
                        if ptr != 1:
                            fw.write(line)
                        ptr += 1
            print("Deleted")

        except:
            print("Oops! No se pudo eliminar fila")

        try:
            with open(dirtxt, 'r') as fr:
                
                lines = fr.readlines()

                ptr = 1

                # Abriendo en modo de escritura
                with open(dirtxt, 'w') as fw:
                    for line in lines:

                        # Eliminamos la segunda linea
                        if ptr != 2:
                            fw.write(line)
                        ptr += 1
            print("Deleted")

        except:
            print("Oops! No se pudo eliminar fila")


        estacion=open(dirtxt)
        texto0=estacion.read()
        texto1=texto0.replace(fecha_anteayer0,fecha_anteayerc)
        texto2=texto1.replace(fecha_ayer0,fecha_ayerc)
        texto3=texto2.replace(fecha_hoy0,fecha_hoyc)
        texto4=texto3.replace(fecha_anteayer1,fecha_anteayerc)
        texto5=texto4.replace(fecha_ayer1,fecha_ayerc)
        texto6=texto5.replace(fecha_hoy1,fecha_hoyc)
        texto7=texto6.replace(" ",",")
        texto8=texto7.replace("---","9999")
        texto9=texto8.replace(",,",",")
        texto10=texto9.replace(",,,",",")
        texto11=texto10.replace(",,,,",",")
        texto12=texto11.replace(",,", ",")
        #print(texto12)
        estacion1=open(dirtxt,"w")
        estacion1.write(texto12)
        estacion1.close()

        estacion=open(dirtxt)
        texto=estacion.read()
        texto0=texto.replace("12:00a","00:00")
        texto1=texto0.replace("12:10a","00:10")
        texto2=texto1.replace("12:20a","00:20")
        texto3=texto2.replace("12:30a","00:30")
        texto4=texto3.replace("12:40a","00:40")
        texto5=texto4.replace("12:50a","00:50")
        texto6=texto5.replace("1:00a","01:00")
        texto7=texto6.replace("1:10a","01:10")
        texto8=texto7.replace("1:20a","01:20")
        texto9=texto8.replace("1:30a","01:30")
        texto10=texto9.replace("1:40a","01:40")
        texto11=texto10.replace("1:50a","01:50")
        texto12=texto11.replace("2:00a","02:00")
        texto13=texto12.replace("2:10a","02:10")
        texto14=texto13.replace("2:20a","02:20")
        texto15=texto14.replace("2:30a","02:30")
        texto16=texto15.replace("2:40a","02:40")
        texto17=texto16.replace("2:50a","02:50")
        texto18=texto17.replace("3:00a","03:00")
        texto19=texto18.replace("3:10a","03:10")
        texto20=texto19.replace("3:20a","03:20")
        texto21=texto20.replace("3:30a","03:30")
        texto22=texto21.replace("3:40a","03:40")
        texto23=texto22.replace("3:50a","03:50")
        texto24=texto23.replace("4:00a","04:00")
        texto25=texto24.replace("4:10a","04:10")
        texto26=texto25.replace("4:20a","04:20")
        texto27=texto26.replace("4:30a","04:30")
        texto28=texto27.replace("4:40a","04:40")
        texto29=texto28.replace("4:50a","04:50")
        texto30=texto29.replace("5:00a","05:00")
        texto31=texto30.replace("5:10a","05:10")
        texto32=texto31.replace("5:20a","05:20")
        texto33=texto32.replace("5:30a","05:30")
        texto34=texto33.replace("5:40a","05:40")
        texto35=texto34.replace("5:50a","05:50")
        texto36=texto35.replace("6:00a","06:00")
        texto37=texto36.replace("6:10a","06:10")
        texto38=texto37.replace("6:20a","06:20")
        texto39=texto38.replace("6:30a","06:30")
        texto40=texto39.replace("6:40a","06:40")
        texto41=texto40.replace("6:50a","06:50")
        texto42=texto41.replace("7:00a","07:00")
        texto43=texto42.replace("7:10a","07:10")
        texto44=texto43.replace("7:20a","07:20")
        texto45=texto44.replace("7:30a","07:30")
        texto46=texto45.replace("7:40a","07:40")
        texto47=texto46.replace("7:50a","07:50")
        texto48=texto47.replace("8:00a","08:00")
        texto49=texto48.replace("8:10a","08:10")
        texto50=texto49.replace("8:20a","08:20")
        texto51=texto50.replace("8:30a","08:30")
        texto52=texto51.replace("8:40a","08:40")
        texto53=texto52.replace("8:50a","08:50")
        texto54=texto53.replace("9:00a","09:00")
        texto55=texto54.replace("9:10a","09:10")
        texto56=texto55.replace("9:20a","09:20")
        texto57=texto56.replace("9:30a","09:30")
        texto58=texto57.replace("9:40a","09:40")
        texto59=texto58.replace("9:50a","09:50")
        texto60=texto59.replace("10:00a","10:00")
        texto61=texto60.replace("10:10a","10:10")
        texto62=texto61.replace("10:20a","10:20")
        texto63=texto62.replace("10:30a","10:30")
        texto64=texto63.replace("10:40a","10:40")
        texto65=texto64.replace("10:50a","10:50")
        texto66=texto65.replace("11:00a","11:00")
        texto67=texto66.replace("11:10a","11:10")
        texto68=texto67.replace("11:20a","11:20")
        texto69=texto68.replace("11:30a","11:30")
        texto70=texto69.replace("11:40a","11:40")
        texto71=texto70.replace("11:50a","11:50")
        texto72=texto71.replace("12:00p","12:00")
        texto73=texto72.replace("12:10p","12:10")
        texto74=texto73.replace("12:20p","12:20")
        texto75=texto74.replace("12:30p","12:30")
        texto76=texto75.replace("12:40p","12:40")
        texto77=texto76.replace("12:50p","12:50")
        texto78=texto77.replace("1:00p","13:00")
        texto79=texto78.replace("1:10p","13:10")
        texto80=texto79.replace("1:20p","13:20")
        texto81=texto80.replace("1:30p","13:30")
        texto82=texto81.replace("1:40p","13:40")
        texto83=texto82.replace("1:50p","13:50")
        texto84=texto83.replace("2:00p","14:00")
        texto85=texto84.replace("2:10p","14:10")
        texto86=texto85.replace("2:20p","14:20")
        texto87=texto86.replace("2:30p","14:30")
        texto88=texto87.replace("2:40p","14:40")
        texto89=texto88.replace("2:50p","14:50")
        texto90=texto89.replace("3:00p","15:00")
        texto91=texto90.replace("3:10p","15:10")
        texto92=texto91.replace("3:20p","15:20")
        texto93=texto92.replace("3:30p","15:30")
        texto94=texto93.replace("3:40p","15:40")
        texto95=texto94.replace("3:50p","15:50")
        texto96=texto95.replace("4:00p","16:00")
        texto97=texto96.replace("4:10p","16:10")
        texto98=texto97.replace("4:20p","16:20")
        texto99=texto98.replace("4:30p","16:30")
        texto100=texto99.replace("4:40p","16:40")
        texto11=texto100.replace("4:50p","16:50")
        texto12=texto11.replace("5:00p","17:00")
        texto13=texto12.replace("5:10p","17:10")
        texto14=texto13.replace("5:20p","17:20")
        texto15=texto14.replace("5:30p","17:30")
        texto16=texto15.replace("5:40p","17:40")
        texto17=texto16.replace("5:50p","17:50")
        texto18=texto17.replace("6:00p","18:00")
        texto19=texto18.replace("6:10p","18:10")
        texto110=texto19.replace("6:20p","18:20")
        texto111=texto110.replace("6:30p","18:30")
        texto112=texto111.replace("6:40p","18:40")
        texto113=texto112.replace("6:50p","18:50")
        texto114=texto113.replace("7:00p","19:00")
        texto115=texto114.replace("7:10p","19:10")
        texto116=texto115.replace("7:20p","19:20")
        texto117=texto116.replace("7:30p","19:30")
        texto118=texto117.replace("7:40p","19:40")
        texto119=texto118.replace("7:50p","19:50")
        texto120=texto119.replace("8:00p","20:00")
        texto121=texto120.replace("8:10p","20:10")
        texto122=texto121.replace("8:20p","20:20")
        texto123=texto122.replace("8:30p","20:30")
        texto124=texto123.replace("8:40p","20:40")
        texto125=texto124.replace("8:50p","20:50")
        texto126=texto125.replace("9:00p","21:00")
        texto127=texto126.replace("9:10p","21:10")
        texto128=texto127.replace("9:20p","21:20")
        texto129=texto128.replace("9:30p","21:30")
        texto130=texto129.replace("9:40p","21:40")
        texto131=texto130.replace("9:50p","21:50")
        texto132=texto131.replace("10:00p","22:00")
        texto133=texto132.replace("10:10p","22:10")
        texto134=texto133.replace("10:20p","22:20")
        texto135=texto134.replace("10:30p","22:30")
        texto136=texto135.replace("10:40p","22:40")
        texto137=texto136.replace("10:50p","22:50")
        texto138=texto137.replace("11:00p","23:00")
        texto139=texto138.replace("11:10p","23:10")
        texto140=texto139.replace("11:20p","23:20")
        texto141=texto140.replace("11:30p","23:30")
        texto142=texto141.replace("11:40p","23:40")
        texto143=texto142.replace("11:50p","23:50")
        texto144=texto143.replace("101:00","11:00")
        texto145=texto144.replace("101:10","11:10")
        texto146=texto145.replace("101:20","11:20")
        texto147=texto146.replace("101:30","11:30")
        texto148=texto147.replace("101:40","11:40")
        texto149=texto148.replace("101:50","11:50")
        texto150=texto149.replace("113:00","23:00")
        texto151=texto150.replace("113:10","23:10")
        texto152=texto151.replace("113:20","23:20")
        texto153=texto152.replace("113:30","23:30")
        texto154=texto153.replace("113:40","23:40")
        texto155=texto154.replace("113:50","23:50")
        estacion1=open(dirtxt,"w")
        estacion1.write(texto155)
        estacion1.close()
        estacion.close()

        estacion=open(dirtxt)
        texto0=estacion.read()
        texto1=texto0.replace(",,",",")
        texto2=texto1.replace(",Date",",Fecha")
        estacion1=open(dircsv,"w")
        estacion1.write(texto2)
        #print(texto2)
        estacion1.close()
        estacion.close()
    
        estacion=pd.read_csv(dircsv, usecols=(1,2,3,6,7,8,9,11,12,16,17), index_col=0, header=0)
        #print(estacion)
        estacion.to_csv(dircsv)
    

        estacion=open(dircsv)
        nombrescol=estacion.read()
        texto1=nombrescol.replace("Out","temperatura")
        texto2=texto1.replace("Hum","humedadRelativa")
        texto3=texto2.replace("Pt.","puntoRocio")
        texto4=texto3.replace("Speed.1","velocidadRacha")
        texto5=texto4.replace("Dir.1","direccionRacha")
        texto6=texto5.replace("Speed","velocidadViento")
        texto7=texto6.replace("Dir","direccionViento")
        texto8=texto7.replace("Bar","presionBar")
        texto9=texto8.replace("Rain","lluvia")
        estacion1=open(dircsv,"w")
        estacion1.write(texto9)
        estacion1.close()
        estacion.close()

        estacion=open(dircsv)
        texto=estacion.read()
        texto1=texto.replace("NNE","22.5")
        texto2=texto1.replace("ENE","67.5")
        texto3=texto2.replace("ESE","112.5")
        texto4=texto3.replace("SSE","157.5")
        texto5=texto4.replace("SSW","202.5")
        texto6=texto5.replace("WSW","247.5")
        texto7=texto6.replace("WNW","292.5")
        texto8=texto7.replace("NNW","337.5")
        texto9=texto8.replace("NE","45")
        texto10=texto9.replace("SE","135")
        texto11=texto10.replace("SW","225")
        texto12=texto11.replace("NW","315")
        estacion1=open(dircsv,"w")
        estacion1.write(texto12)
        estacion1.close()
        estacion.close()

        estacion=open(dircsv)
        texto=estacion.read()
        texto1=texto.replace("N","360")
        texto2=texto1.replace("E","90")
        texto3=texto2.replace("S","180")
        texto4=texto3.replace("W","270")
        estacion1=open(dircsv,"w")
        estacion1.write(texto4)
        estacion1.close()
        estacion.close()
        
        estacion=pd.read_csv(dircsv, index_col=0, header=0)
        #print(estacion)
        estacion['fechaHora']=estacion['Fecha'].map(str)  + ' ' + estacion['Time'].map(str)
        estacion
        #print(estacion)
        estacion.to_csv(dircsv)


        DF=pd.read_csv(dircsv, index_col=0)
        DF['idEstacion']=np.where(DF['Time'] !='[]',clave, ' ', )
        #print(DF)
        DF.to_csv(dircsv)

        estacion=pd.read_csv(dircsv, usecols=(3,4,5,6,7,8,9,10,11,12,13), index_col=0, header=0)
        print(estacion)
        estacion.to_csv(dircsv)

        print('Datos de la estación estacion',clave,'listos')
        final=datetime.now()
        print("El proceso se completo a las",final,"la proxima ejecución será en 05 minutos")
    except:
        final=datetime.now()
        print("No se logro obtener datos de la estación",clave)
        print("Se presento un error, la próxima ejecición será dentro de 05 minutos a partir de la hora:",final)
        try:
            remove(dircsv)
        except:
            print("No existe el archivo "+ dircsv)


# try:
#     procesonew("iztacalco","AGOS")
# except:
#     print("Hubo un problema con la descarga de datos de estaestación")


try:
    procesoold("juarez", "SGIRPC")
except:
    print("Hubo un problema con la descarga de datos de estaestación")